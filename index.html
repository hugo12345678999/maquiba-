<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M치quina Grua</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            background-color: #e5f2fc;
        }
        header {
            background-color: #acc9f0;
            color: black;
            text-align: center;
            padding: 10px 0;
            font-size: 24px;
            width: 100%;
        }
        .content-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 1400px;
            padding: 20px;
            display: none;
        }
        .live-stream-container {
            flex-grow: 2;
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            margin-right: 20px;
        }
        .live-stream iframe {
            width: 100%;
            height: 600px;
            border-radius: 10px;
            filter: brightness(1.1);
        }
        .button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f6c222;
            border-radius: 50%;
            padding: 30px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }
        .button-row {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }
        button {
            width: 70px;
            height: 70px;
            background-color: lightgray;
            border: none;
            border-radius: 5px;
            font-size: 28px;
            margin: 10px;
            cursor: pointer;
            user-select: none;
        }
        button:active {
            background-color: gray;
        }
        button:focus {
            outline: none;
        }
        .descend-button {
            width: 200px;
            height: 50px;
            font-size: 32px;
        }
        /* Ajustes para dispositivos m칩veis */
        @media (max-width: 768px) {
            .content-container {
                flex-direction: column;
                align-items: center;
            }
            .live-stream-container {
                margin-right: 0;
                margin-bottom: 30px;
                padding: 20px;
            }
            .live-stream iframe {
                height: 400px;
            }
            .button-container {
                padding: 20px;
            }
            button {
                width: 60px;
                height: 60px;
                font-size: 24px;
                margin: 5px;
            }
            .descend-button {
                width: 180px;
                height: 45px;
                font-size: 28px;
            }
        }
        @media (max-width: 480px) {
            .live-stream iframe {
                height: 300px;
            }
            button {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            .descend-button {
                width: 160px;
                height: 40px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <header>
        M치quina Online
    </header>
    <div class="button-container">
        <button id="maquina1">M치quina 1</button>
        <button id="maquina2">M치quina 2</button>
    </div>
    <div id="maquina1-content" class="content-container">
        <div class="live-stream-container">
            <div class="live-stream">
                <iframe src="https://delaysp01.logicahost.com.br:5443/toybox/play.html?name=camera01" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
        <div class="button-container">
            <div class="button-row">
                <button data-action="setacima" id="up-button">拘勇</button>
            </div>
            <div class="button-row">
                <button data-action="setaesquerda" id="left-button">拘勇</button>
                <button data-action="setadireita" id="right-button">俱뫮잺</button>
            </div>
            <div class="button-row">
                <button data-action="setabaixo" id="down-button">拘勇</button>
            </div>
            <div class="button-row">
                <button class="descend-button" data-action="descer" id="descend-button">DESCER</button>
            </div>
            <div class="button-row">
                <button data-action="credito" id="buy-button">游눱</button>
            </div>
        </div>
    </div>

    <div id="maquina2-content" class="content-container">
        <div class="live-stream-container">
            <div class="live-stream">
                <iframe src="https://delaysp01.logicahost.com.br:5443/toybox/play.html?name=camera02" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
        </div>
        <div class="button-container">
            <div class="button-row">
                <button data-action="setacima" id="up-button2">拘勇</button>
            </div>
            <div class="button-row">
                <button data-action="setaesquerda" id="left-button2">拘勇</button>
                <button data-action="setadireita" id="right-button2">俱뫮잺</button>
            </div>
            <div class="button-row">
                <button data-action="setabaixo" id="down-button2">拘勇</button>
            </div>
            <div class="button-row">
                <button class="descend-button" data-action="descer" id="descend-button2">DESCER</button>
            </div>
            <div class="button-row">
                <button data-action="credito" id="buy-button2">游눱</button>
            </div>
        </div>
    </div>

    <audio id="click-sound" src="click.mp3" preload="auto"></audio>
    <audio id="claw-sound" src="garra.mp3" preload="auto"></audio>
    <audio id="background-music" src="background-music.mp3" preload="auto" loop></audio>

    <script>
        const backgroundMusic = document.getElementById('background-music');
        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI1ZjBmMWM5YS1lOTk3LTQxNTctOTg1MC01MDEwNjVhYjZmOWUiLCJpYXQiOjE3MjM1OTQ5MTh9.s5EIFP5utz3nyPmXxaASMrHQ98vj9dCRLVGYVi0VOuE';

        let intervalId;

        function playSound(soundId) {
            const sound = document.getElementById(soundId);
            sound.currentTime = 0;
            sound.play();
        }

        function sendAction(action) {
            const maquinaId = document.querySelector('div.content-container[style*="display: flex;"]').id === 'maquina1-content' ? '1' : '2';
            let url = '';
            let method = 'POST';
            if (action === 'descer') {
                url = `https://gilson-telemetria-88dd714ac1f5.herokuapp.com/descer/${maquinaId}`;
                method = 'POST';
            } else {
                url = `https://gilson-telemetria-88dd714ac1f5.herokuapp.com/${action}/${maquinaId}`;
            }
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'x-access-token': token
                },
                body: action !== 'descer' ? JSON.stringify({ value: action }) : null
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro ao enviar a requisi칞칚o');
                }
                console.log(`A칞칚o ${action} enviada com sucesso`);
                if (action === 'descer') playSound('claw-sound');
                else playSound('click-sound');
            })
            .catch(error => console.error(error));
        }

        function startSendingRequests(action) {
            intervalId = setInterval(() => sendAction(action), 30);
        }

        function stopSendingRequests() {
            clearInterval(intervalId);
        }

        function handleButtonAction(action) {
            if (action === 'descer') {
                startSendingRequests(action);
            } else {
                sendAction(action);
            }
        }

        function checkMachineStatus(machineId) {
            return fetch(`https://gilson-telemetria-88dd714ac1f5.herokuapp.com/status/${machineId}`, {
                headers: {
                    'x-access-token': token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.online === "9999-12-31T23:59:59.000Z") {
                    return true; // M치quina pode ser acessada
                }
                return false; // M치quina n칚o pode ser acessada
            })
            .catch(error => {
                console.error('Erro ao verificar status da m치quina:', error);
                return false; // Tratar erro como inacess칤vel
            });
        }

        function handleMachineClick(machineId) {
            checkMachineStatus(machineId).then(canAccess => {
                if (canAccess) {
                    document.querySelectorAll('.content-container').forEach(container => {
                        container.style.display = 'none';
                    });
                    document.getElementById(`${machineId}-content`).style.display = 'flex';
                } else {
                    alert('M치quina n칚o dispon칤vel.');
                }
            });
        }

        document.querySelectorAll('#up-button, #left-button, #right-button, #down-button, #descend-button').forEach(button => {
            button.addEventListener('mousedown', () => handleButtonAction(button.dataset.action));
            button.addEventListener('touchstart', () => handleButtonAction(button.dataset.action));
            button.addEventListener('mouseup', stopSendingRequests);
            button.addEventListener('mouseleave', stopSendingRequests);
            button.addEventListener('touchend', stopSendingRequests);
        });

        document.querySelectorAll('#up-button2, #left-button2, #right-button2, #down-button2, #descend-button2').forEach(button => {
            button.addEventListener('mousedown', () => handleButtonAction(button.dataset.action));
            button.addEventListener('touchstart', () => handleButtonAction(button.dataset.action));
            button.addEventListener('mouseup', stopSendingRequests);
            button.addEventListener('mouseleave', stopSendingRequests);
            button.addEventListener('touchend', stopSendingRequests);
        });

        document.querySelectorAll('#maquina1, #maquina2').forEach(button => {
            button.addEventListener('click', () => handleMachineClick(button.id.replace('maquina', '')));
        });

        backgroundMusic.play();
    </script>
</body>
</html>

